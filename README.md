## Общее описание
Сервис предназначен для борьбы с подбором паролей при авторизации в какой-либо системе.

Сервис вызывается перед авторизацией пользователя и может либо разрешить, либо заблокировать попытку.

Предполагается, что сервис используется только для server-server, т.е. скрыт от конечного пользователя.

## Алгоритм работы
Сервис ограничивает частоту попыток авторизации для различных комбинаций параметров
Пример настроек по умолчанию:
* не более N = 10 попыток в минуту для данного логина.
* не более M = 100 попыток в минуту для данного пароля (защита от обратного brute-force).
* не более K = 1000 попыток в минуту для данного IP (число большое, т.к. NAT).

Для подсчета и ограничения частоты запросов, используется алгоритм leaky bucket.

Сервис поддерживает множество bucket-ов, по одному на каждый логин/пароль/ip.

Bucket-ы хранятся в памяти (при этом реализован алгоритм удаление просроченных записей и бакетов).

Сервис поддерживает White/black листы.
White/black листы содержат списки адресов сетей, которые обрабатываются более простым способом:
* Если входящий IP в whitelist, то сервис безусловно разрешает авторизацию (ok=true);
* Если - в blacklist, то отклоняет (ok=false).

## Архитектура
Микросервис состоит из:
API HTTP, 
CLI клиента, работающего по grpc, 
базы данных для хранения black/white списков.

## Описание методов API

### Попытка авторизации: http://localhost:8081/auth/?ip=10.10.10.128&login=ids&pass=123
Передача параметров методом GET: ip, login pass
Ответ:
1, если считает что запрос нормальный.
0, если считает что происходит bruteforce.

### Сброс bucketa: http://localhost:8081/reset-bucket?ip=10.10.10.128&login=ids&pass=123
Должен очистить bucket-ы соответствующие переданным ip, login и ip.
Передача параметров методом GET: ip, login pass.
Возможна передача не всех параметров.

### Добавление IP в blacklist: http://localhost:8081/add-black-list/?ip=10.10.10.50&mask=25
Добавить в blacklist подсеть с указанным IP и маской.
Передача параметров методом GET: ip, mask.

### Удаление IP из blacklist: http://localhost:8081/add-black-list/?ip=10.10.10.50
Удалить из blacklist подсеть с указанным IP.
Передача параметров методом GET: ip.

### Добавление IP в whitelist: http://localhost:8081/add-white-list/?ip=10.10.10.50&mask=25
Добавить в whitelist подсеть с указанным IP и маской.
Передача параметров методом GET: ip, mask

### Удаление IP из whitelist: http://localhost:8081/add-white-list/?ip=10.10.10.50
Удалить из whitelist подсеть с указанным IP.
Передача параметров методом GET: ip.

- Пример подсети: 192.1.1.0/25 - представляет собой адрес 192.1.1.0 с маской 255.255.255.128
- Во время работы сервиса при поступлении очередного IP адреса, сервис проходится по подсетям в черных и белых списках и вычисляет, принадлежит ли IP одной из них.

### Получения списка whitelist и blacklist: http://localhost:8081/get-list?type=w
Получить список подсетей blacklist или whitelist в зависимости от зхначения параметра type.
"b" - blacklist, "w" - whitelist.
Передача параметров методом GET: type.
Список получаемых значений в формате json:
[
    {
        "IP": "10.10.10.250",
        "Mask": "25",
        "IPfrom": "10.10.10.128",
        "IPto": "10.10.10.255"
    }
]



---

## Конфигурация
Основные параметры конфигурации: N, M, K - лимиты по достижению которых, сервис считает попытку брутфорсом.

## Command-Line интерфейс
Необходимо так же разработать command-line интерфейс для ручного администрирования сервиса.
Через CLI должна быть возможность вызвать сброс бакета и управлять whitelist/blacklist-ом.
CLI может работать через GRPC/HTTP интерфейс.

## Развертывание
Развертывание микросервиса должно осуществляться командой `make run` (внутри `docker compose up`)
в директории с проектом.

## Тестирование
Рекомендуется выделить модуль обработки одного bucket и протестировать его с помощью unit-тестов.

Так же необходимо написать интеграционные тесты, проверяющие все вызовы API.
